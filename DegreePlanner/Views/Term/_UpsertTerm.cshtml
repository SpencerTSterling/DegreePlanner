@model List<DegreePlanner.Models.Term>

<div class="container">
    <div class="row pt-4 pb-3">
        <div class="col-6">
            <h2 class="text-primary">
                Term List
            </h2>
        </div>
        <div class="col-6 text-end">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#upsertTermModal">
                <i class="bi bi-plus-circle"></i> Add Term
            </button>
        </div>
    </div>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Term Name</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var term in Model.OrderBy(u => u.Id))
            {
                <tr>
                    <td>@term.Name</td>
                    <td>@term.StartDate?.ToString("yyyy-MM-dd")</td>
                    <td>@term.EndDate?.ToString("yyyy-MM-dd")</td>
                    <td>
                        <div class="btn-group" role="group">
                            <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#upsertTermModal"
                               data-term-id="@term.Id">
                                <i class="bi bi-pen-fill"></i> Edit
                            </a>
                            <!-- Add delete functionality if needed -->
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Modal -->
<div id="upsertTermModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Term</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="upsertTermModalBody"></div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.min.js"></script>
    <script>
        // Function to load the modal content with term details for editing
        function loadTermModal(id) {
            $.get('@Url.Action("Upsert", "Term")', { id: id })
                .done(function (data) {
                    $('#upsertTermModalBody').html(data);
                    $('#upsertTermModal').modal('show');
                })
                .fail(function () {
                    console.error('Failed to load term details.');
                });
        }

        // Handle modal shown event to dynamically load content
        $('#upsertTermModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget); // Button that triggered the modal
            var termId = button.data('term-id'); // Extract term ID from data attribute
            loadTermModal(termId); // Load modal content with the term details
        });

        // Handle AJAX form submission completion to refresh DegreePlan section
        function refreshDegreePlan() {
            $.get('@Url.Action("Index", "DegreePlan")')
                .done(function (data) {
                    $('#degreePlanContainer').html(data);
                })
                .fail(function () {
                    console.error('Failed to refresh DegreePlan.');
                });
        }
    </script>
}
