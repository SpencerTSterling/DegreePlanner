@model IEnumerable<DegreePlanner.Models.CourseItem>

@if (Model != null && Model.Any())
{
    <ul class="list-group">
        @foreach (var item in Model)
        {
            <li class="list-group-item course-item @(item.IsCompleted ? "list-group-item-success" : "")">
                <div class="form-check">
                    <!-- Checkbox for marking course item as complete -->
                    <input type="checkbox" class="form-check-input" id="courseItem_@item.Id" @(item.IsCompleted ? "checked" : "") onclick="markAsComplete(@item.Id, this)">
                    <label class="form-check-label" for="courseItem_@item.Id">
                        <span class="course-item-type">@item.Type</span> - <span class="course-item-name">@item.Name</span>
                    </label>
                </div>
                <span class="course-item-due-date">Due Date: @(item.DueDate.HasValue ? item.DueDate.Value.ToString("yyyy-MM-dd") : "No due date")</span>
            </li>
        }
    </ul>
}
else
{
    <p>Nothing to do yet.</p>
}

<script>
    function markAsComplete(itemId, checkbox) {
        console.log('Checkbox clicked for item ID:', itemId, 'Completed:', checkbox.checked);
        var isCompleted = checkbox.checked;

        $.post('@Url.Action("MarkCourseItemAsComplete", "Dashboard")', { id: itemId, isCompleted: isCompleted })
            .done(function () {
                // Update the UI based on the completion state without refreshing
                if (isCompleted) {
                    $(checkbox).closest('.course-item').addClass('list-group-item-success');
                } else {
                    $(checkbox).closest('.course-item').removeClass('list-group-item-success');
                }
            })
            .fail(function () {
                console.error('Failed to update course item.');
            });
    }

</script>
